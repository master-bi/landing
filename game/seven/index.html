<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>行動版百家樂樣板</title>
<style>
  :root{
    --bg:#0e1525;
    --panel:#101a2e;
    --panel-2:#0b1424;
    --accent:#ff2f5f;
    --accent-2:#27b0ff;
    --accent-3:#3ed07a;
    --gold:#ffb86b;
    --chip:#1b263b;
    --text:#e6f2ff;
    --muted:#9fb3c8;
    --card:#ffffff;
    --card-back:#2d3e60;
    --btn:#1d2942;
  }
  *{box-sizing:border-box}
  html,body{height:100%;background:var(--bg);color:var(--text);font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;}
  body{margin:0;display:flex;justify-content:center;}
  /* outer phone canvas (依手機比例) */
  .phone{
    width:min(420px,100vw);
    min-height:100vh;
    background:linear-gradient(180deg,#0b1321 0%, #0f1a2d 35%, #0b1321 100%);
    position:relative;
    overflow:hidden;
  }
  /* 頂部桌面＋荷官區（用漸層與幾何線條代替真人影片） */
  .dealer-area{
    position:relative;
    height: 270px;
    background:
      radial-gradient(100% 80% at 50% 10%, #1a2b4f 0 35%, transparent 36%) top/100% 70% no-repeat,
      linear-gradient(135deg, #182642 0%, #121b31 100%);
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  /* 偽造桌台 */
  .table-oval{
    position:absolute;left:50%;top:58%;transform:translate(-50%,-50%);
    width:92%;height:120px;border-radius:70px;
    background:linear-gradient(180deg,#a6123a 0%, #8b1235 100%);
    outline:6px solid #6a0f29;box-shadow:0 8px 24px rgba(0,0,0,.45) inset;
  }
  .table-edge{
    position:absolute;left:50%;top:58%;transform:translate(-50%,-50%);
    width:96%;height:140px;border-radius:74px;border:6px solid #b93869;
    opacity:.7;pointer-events:none;
  }
  /* 倒數泡泡 */
  .timer-bubble{
    position:absolute;top:18px;left:18px;
    width:64px;height:64px;border-radius:40px;
    display:grid;place-items:center;font-weight:800;font-size:22px;
    color:#111; background:#2cff7e; box-shadow:0 0 0 6px rgba(44,255,126,.22);
  }
  .phase-tag{
    position:absolute;top:26px;right:16px;
    font-size:12px;padding:.28rem .5rem;border-radius:99px;
    background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);
    letter-spacing:.1em
  }

  /* 下注面板區 */
  .bet-panels{
    display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;
    padding:12px;border-top:1px solid rgba(255,255,255,.06);
    background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0) 40%);
  }
  .bet{
    border-radius:10px; overflow:hidden; position:relative;
    min-height:110px; display:flex; align-items:center; justify-content:center;
    font-weight:900; font-size:42px; text-shadow:0 2px 0 rgba(0,0,0,.3);
    border:1px solid rgba(255,255,255,.06);
    user-select:none; cursor:pointer;
  }
  .bet.disabled{opacity:.45;pointer-events:none;filter:grayscale(.6)}
  .bet.player{ background:linear-gradient(180deg,#dff2ff,#bde5ff); color:#0079ff }
  .bet.tie   { background:linear-gradient(180deg,#ecffe8,#c3ffd1); color:#0a9b4e }
  .bet.banker{ background:linear-gradient(180deg,#ffe9ee,#ffd0dc); color:#d01845 }
  .odds{ position:absolute; bottom:6px; left:8px; font-size:12px; color:#123; opacity:.8; font-weight:700}
  .pile{ position:absolute; inset:auto 6px 6px auto; padding:.22rem .4rem; font-size:12px; color:#123; background:rgba(255,255,255,.55); border-radius:6px; font-weight:800 }
  .yourbet{ position:absolute; top:6px; right:6px; font-size:12px; font-weight:700; color:#123; background:rgba(255,255,255,.75); padding:.18rem .36rem; border-radius:6px}

  /* 籌碼列 */
  .chips{ display:flex; gap:12px; padding:10px 12px; align-items:center; overflow-x:auto }
  .chip{
    --c:#3da7ff;
    width:58px;height:58px;border-radius:40px; flex:0 0 auto;
    background: radial-gradient(circle at 50% 45%, var(--c), #144b7f 70%);
    border:6px solid #e6f2ff; color:#fff; font-weight:900; display:grid; place-items:center;
    text-shadow:0 2px 0 rgba(0,0,0,.35); cursor:pointer; box-shadow:0 2px 0 #0b2948 inset, 0 4px 12px rgba(0,0,0,.35)
  }
  .chip span{font-size:12px;letter-spacing:.02em}
  .chip.active{outline:4px solid var(--gold)}
  .chip.c2{--c:#7adf6e}
  .chip.c3{--c:#ff7a7a}
  .chip.c4{--c:#f5c156}
  .chip.c5{--c:#8f7fff}
  .chip.c6{--c:#00c2a8}
  .chip.c7{--c:#f07d2f}

  /* 卡牌展示區（開牌時顯示） */
  .reveal{
    display:grid; grid-template-columns:1fr 1fr; gap:10px; padding:8px 12px;
    transition:300ms; opacity:0; height:0; overflow:hidden;
  }
  .reveal.show{opacity:1;height:auto}
  .cards{
    background:var(--panel-2); border:1px solid rgba(255,255,255,.06);
    border-radius:10px; padding:8px; display:flex; flex-wrap:wrap; gap:8px; justify-content:center;
  }
  .who{font-size:12px;color:var(--muted);text-align:center;margin-bottom:6px}
  .card{
    width:58px; height:80px; border-radius:8px; background:var(--card); color:#111;
    display:grid; place-items:center; font-weight:900; font-size:26px; box-shadow:0 2px 0 rgba(0,0,0,.25)
  }
  .card.back{ background:var(--card-back); box-shadow:0 2px 0 rgba(0,0,0,.4) inset; }
  .card .s{font-size:16px; line-height:1}
  .score{
    margin-top:6px; text-align:center; font-size:13px; color:var(--muted)
  }
  .banner{
    margin:6px 12px 2px; text-align:center; font-weight:800; padding:.35rem .6rem;
    border-radius:10px; background:rgba(255,255,255,.09); border:1px solid rgba(255,255,255,.12)
  }

  /* 路單（簡化版 bead plate） */
  .bead{
    margin:10px 10px 14px; background:rgba(255,255,255,.03);
    border:1px solid rgba(255,255,255,.06); border-radius:10px; padding:6px;
  }
  .grid{
    display:grid; grid-template-columns: repeat(18, 1fr); gap:4px;
    height:120px;
  }
  .cell{
    background:#0f1a30; border-radius:6px; display:grid; place-items:center;
    font-size:10px; color:#9fb3c8; border:1px solid rgba(255,255,255,.05)
  }
  .cell.p{color:#2aa3ff}
  .cell.b{color:#ff3f69}
  .cell.t{color:#3ed07a}

  /* 下方工具列（聊天輸入假欄） */
  .toolbar{
    display:flex; align-items:center; gap:8px; padding:8px 10px; background:linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.25));
    position:sticky; bottom:0;
  }
  .chat{
    flex:1; background:#111c31; border:1px solid rgba(255,255,255,.08); color:#aac2da;
    padding:.6rem .8rem; border-radius:28px; font-size:14px
  }
  .small-btn{
    width:44px;height:44px;border-radius:14px;background:#10203a;border:1px solid rgba(255,255,255,.1);
    display:grid;place-items:center;color:#a9c1da; font-weight:900
  }

  /* 預設提示 */
  .hint{
    margin:8px 12px 0; color:#9fb3c8; font-size:12px; letter-spacing:.02em
  }
</style>
</head>
<body>
<div class="phone" id="app">
  <!-- 荷官區 + 計時 -->
  <div class="dealer-area">
    <div class="timer-bubble" id="timer">15</div>
    <div class="phase-tag" id="phaseTag">下注中</div>
    <div class="table-oval"></div>
    <div class="table-edge"></div>
  </div>

  <!-- 下注面板 -->
  <div class="bet-panels">
    <div class="bet player" data-side="player">
      <div class="yourbet" id="betP">0</div>
      閒
      <div class="odds">1:1</div>
    </div>
    <div class="bet tie" data-side="tie">
      <div class="yourbet" id="betT">0</div>
      和
      <div class="odds">1:8</div>
    </div>
    <div class="bet banker" data-side="banker">
      <div class="yourbet" id="betB">0</div>
      莊
      <div class="odds">0.95</div>
    </div>
  </div>

  <!-- 籌碼列 -->
  <div class="chips" id="chips">
    <div class="chip c1 active" data-v="100"><span>100</span></div>
    <div class="chip c2" data-v="500"><span>500</span></div>
    <div class="chip c3" data-v="1000"><span>1K</span></div>
    <div class="chip c4" data-v="5000"><span>5K</span></div>
    <div class="chip c5" data-v="10000"><span>10K</span></div>
    <div class="chip c6" data-v="50000"><span>50K</span></div>
    <div class="chip c7" data-v="100000"><span>100K</span></div>
  </div>

  <!-- 開牌展示 -->
  <div class="banner" id="bankroll">餘額：100,000</div>
  <div class="reveal" id="reveal">
    <div>
      <div class="who">PLAYER</div>
      <div class="cards" id="cardsP"></div>
      <div class="score" id="scoreP">點數 0</div>
    </div>
    <div>
      <div class="who">BANKER</div>
      <div class="cards" id="cardsB"></div>
      <div class="score" id="scoreB">點數 0</div>
    </div>
  </div>

  <!-- 路單 -->
  <div class="bead">
    <div class="hint">簡易路單（最近 18 手）</div>
    <div class="grid" id="road"></div>
  </div>

  <!-- 底部工具列/聊天假欄 -->
  <div class="toolbar">
    <div class="small-btn">💬</div>
    <input class="chat" value="下注達 100 元，開始聊天" readonly />
    <div class="small-btn">＋</div>
  </div>
</div>

<script>
(function(){
  const PHASES = [
    {name:'bet',   label:'下注中',  secs:15},
    {name:'reveal',label:'開牌中',  secs:5},
    {name:'settle',label:'結算中',  secs:5},
  ];

  // 狀態
  let bankroll = 100000;
  const limitMin = 100, limitMax = 100000;
  let bets = {player:0, tie:0, banker:0};
  let chip = 100;
  let timer = 0, phaseIdx = 0, ticker;
  let deck = [];
  const road = [];

  // dom
  const timerEl = document.getElementById('timer');
  const phaseTag = document.getElementById('phaseTag');
  const bankrollEl = document.getElementById('bankroll');
  const betBtns = document.querySelectorAll('.bet');
  const betP = document.getElementById('betP');
  const betT = document.getElementById('betT');
  const betB = document.getElementById('betB');
  const chips = document.getElementById('chips');
  const reveal = document.getElementById('reveal');
  const cardsP = document.getElementById('cardsP');
  const cardsB = document.getElementById('cardsB');
  const scoreP = document.getElementById('scoreP');
  const scoreB = document.getElementById('scoreB');
  const roadEl = document.getElementById('road');

  // 工具
  const fmt = n => n.toLocaleString('en-US');

  function updateBetsUI(){
    betP.textContent = fmt(bets.player);
    betT.textContent = fmt(bets.tie);
    betB.textContent = fmt(bets.banker);
    bankrollEl.textContent = `餘額：${fmt(bankroll)}`;
  }

  function enableBet(enabled){
    betBtns.forEach(b => {
      if(enabled) b.classList.remove('disabled');
      else b.classList.add('disabled');
    });
  }

  // 籌碼選取
  chips.addEventListener('click', e=>{
    const t = e.target.closest('.chip'); if(!t) return;
    chips.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
    t.classList.add('active'); chip = +t.dataset.v;
  });

  // 加注
  betBtns.forEach(b => {
    b.addEventListener('click', ()=>{
      if(PHASES[phaseIdx].name !== 'bet') return;
      if(bankroll < chip) return;
      let side = b.dataset.side;
      let next = bets[side] + chip;
      if(next < limitMin) next = limitMin;
      if(next > limitMax) next = limitMax;
      const delta = next - bets[side];
      if(delta <= 0 || bankroll < delta) return;
      bets[side] = next;
      bankroll -= delta;
      updateBetsUI();
    });
  });

  // 牌組
  function freshDeck(){
    const suits = ['♣','♦','♥','♠'];
    deck = [];
    for(let s of suits){
      for(let r=1;r<=13;r++){
        deck.push({r,s});
      }
    }
    // 洗牌
    for(let i=deck.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [deck[i], deck[j]] = [deck[j], deck[i]];
    }
  }
  function draw(){ if(deck.length<6) freshDeck(); return deck.pop(); }
  function cardVal(r){ return r>=10 ? 0 : r; } // JQK=0
  function handPoint(hand){ return hand.reduce((a,c)=> (a + cardVal(c.r))%10, 0); }

  // 動畫顯示卡片
  function showCards(where, hand){
    const wrap = where==='P' ? cardsP : cardsB;
    wrap.innerHTML = '';
    hand.forEach((c,i)=>{
      const d=document.createElement('div');
      d.className='card back';
      wrap.append(d);
      // 翻牌
      setTimeout(()=>{
        d.classList.remove('back');
        d.innerHTML = face(c);
        d.style.transform='rotateY(360deg)';
        d.style.transition='300ms';
      }, 300 + i*350);
    });
  }
  function face(c){
    const map = {1:'A',11:'J',12:'Q',13:'K'};
    const rank = map[c.r] || c.r;
    const red = (c.s==='♦'||c.s==='♥');
    return `<div style="color:${red?'#e8455a':'#111'}">${rank}<div class="s">${c.s}</div></div>`;
  }

  // 百家樂第三張牌規則（簡化/遵循常見規則）
  function playRound(){
    // 初始牌
    const p = [draw(), draw()];
    const b = [draw(), draw()];
    let pp = handPoint(p), bp = handPoint(b);

    let natural = (pp>=8 || bp>=8);

    let pThird=null, bThird=null;
    if(!natural){
      // Player draw rule
      if(pp<=5){ pThird = draw(); p.push(pThird); pp = handPoint(p); }

      // Banker rule（依 Player 第三張）
      if(!pThird){ // player stand
        if(bp<=5){ bThird = draw(); b.push(bThird); bp = handPoint(b); }
      }else{
        const v = cardVal(pThird.r);
        if(bp<=2) bThird = draw();
        else if(bp===3 && v!==8) bThird = draw();
        else if(bp===4 && v>=2 && v<=7) bThird = draw();
        else if(bp===5 && v>=4 && v<=7) bThird = draw();
        else if(bp===6 && (v===6||v===7)) bThird = draw();
        if(bThird){ b.push(bThird); bp = handPoint(b); }
      }
    }

    // 顯示
    showCards('P', p);
    showCards('B', b);
    scoreP.textContent=`點數 ${pp}`;
    scoreB.textContent=`點數 ${bp}`;

    // 結果
    let win;
    if(pp>bp) win='player';
    else if(pp<bp) win='banker';
    else win='tie';

    // 路單
    road.push(win);
    while(road.length>18) road.shift();
    renderRoad();

    // 派彩
    const pay={player:1, banker:0.95, tie:8};
    const got = Math.floor((bets[win]||0)*pay[win]);
    bankroll += got + (win==='tie' ? (bets.player+bets.banker) : 0); // 和退
    // 清空注
    bets.player=bets.tie=bets.banker=0;
    updateBetsUI();

    // 結果橫幅
    const txt = win==='player'?'閒勝': win==='banker'?'莊勝':'和局';
    document.querySelector('.banner').textContent = `結算：${txt}　贏得 ${fmt(got)}`;
  }

  function renderRoad(){
    roadEl.innerHTML='';
    road.forEach(r=>{
      const d = document.createElement('div');
      d.className='cell '+(r==='player'?'p': r==='banker'?'b':'t');
      d.textContent = (r==='player'?'閒':'莊') + (r==='tie'?'和':'');
      roadEl.appendChild(d);
    });
    // 填滿網格
    const left = 18-road.length;
    for(let i=0;i<left;i++){
      const d=document.createElement('div');
      d.className='cell';
      roadEl.appendChild(d);
    }
  }

  function clearReveal(){
    reveal.classList.remove('show');
    cardsP.innerHTML='';cardsB.innerHTML='';
    scoreP.textContent='點數 0'; scoreB.textContent='點數 0';
  }

  function toPhase(i){
    phaseIdx = i%PHASES.length;
    const ph = PHASES[phaseIdx];
    timer = ph.secs;
    phaseTag.textContent = ph.label;
    timerEl.textContent = timer;
    if(ph.name==='bet'){
      enableBet(true);
      clearReveal();
      document.querySelector('.banner').textContent = '下注中…（限紅 100–100,000）';
    }else{
      enableBet(false);
      if(ph.name==='reveal'){
        reveal.classList.add('show');
        // 發牌＋翻牌
        setTimeout(()=> playRound(), 200);
      }
    }
    if(ticker) clearInterval(ticker);
    ticker = setInterval(()=>{
      timer--; if(timer<0){ clearInterval(ticker); toPhase(phaseIdx+1); return; }
      timerEl.textContent = timer;
    },1000);
  }

  // 初始化
  freshDeck();
  updateBetsUI();
  renderRoad();
  toPhase(0);
})();
</script>
</body>
</html>
