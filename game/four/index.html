<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>æ‹‰éœ¸æ©Ÿï½œSlot Machine</title>
<style>
  :root{
    --bg:#0e1116;
    --panel:#151a22;
    --accent:#ff7a00;
    --accent-2:#33d6ff;
    --text:#e8eef7;
    --sub:#9fb2c8;
    --win:#2fe08c;
    --lose:#e84f4f;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:radial-gradient(1200px 500px at 50% -200px,#1b2230 20%,#0e1116 60%),var(--bg);
    color:var(--text); font:16px/1.2 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    display:grid; place-items:center; min-height:100svh; padding:16px;
  }
  .game{
    width:min(720px,95vw); background:linear-gradient(180deg,#161d28,#0f151c);
    border:1px solid #222a36; border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,.45);
    overflow:hidden;
  }
  header{
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 18px; background:linear-gradient(180deg,#1c2432,#131922);
    border-bottom:1px solid #1f2835;
  }
  header h1{font-size:18px; margin:0; letter-spacing:.6px}
  header .right{display:flex; gap:12px; align-items:center}
  .pill{padding:6px 10px; border-radius:999px; background:#0f141b; color:var(--sub); border:1px solid #1f2835}
  .pill b{color:var(--text)}
  .reels{
    display:grid; grid-template-columns:repeat(3,1fr); gap:12px;
    padding:18px; background:linear-gradient(180deg,#0f141c,#0c1117);
  }
  .col{
    background:var(--panel); border:1px solid #202736; border-radius:12px;
    height:340px; display:grid; grid-template-rows:repeat(3,1fr); overflow:hidden;
    position:relative;
  }
  .cell{
    display:grid; place-items:center; font-size:54px; user-select:none;
    border-bottom:1px solid #1e2634;
    background:linear-gradient(180deg,#141b25,#121720);
  }
  .cell:last-child{border-bottom:none}
  .spinning .cell{filter:saturate(0.8) blur(.4px); opacity:.85}
  .col.spin{
    animation:spinCol .7s cubic-bezier(.45,.03,.2,1.02) 3;
  }
  @keyframes spinCol{
    0%{transform:translateY(0)}
    50%{transform:translateY(-20px)}
    100%{transform:translateY(0)}
  }
  .panel{
    display:grid; grid-template-columns:1fr; gap:10px; padding:10px 18px 18px;
  }
  .controls{
    display:grid; grid-template-columns:repeat(12,1fr); gap:10px;
    background:#0f141b; padding:12px; border:1px solid #1f2835; border-radius:12px;
  }
  .controls > div{grid-column:span 3; background:#121823; border:1px solid #1e2735; border-radius:10px; padding:10px}
  .controls label{display:block; font-size:12px; color:var(--sub); margin-bottom:6px}
  .controls .value{font-weight:700; letter-spacing:.5px}
  .controls button, .controls select{
    width:100%; margin-top:6px; padding:10px 12px; border-radius:10px;
    border:1px solid #243041; background:#101725; color:var(--text);
  }
  .controls button.primary{
    grid-column:span 6; background:linear-gradient(180deg,#ff8a1a,#ff6f00); color:#101;
    border:0; font-weight:800; letter-spacing:.8px; box-shadow:0 6px 20px rgba(255,122,0,.25);
  }
  .controls button.primary:disabled{filter:grayscale(.8); opacity:.6}
  .controls button.sec{grid-column:span 3}
  .msg{
    padding:10px 12px; border:1px dashed #2b3747; border-radius:10px; color:var(--sub);
    display:flex; align-items:center; gap:8px
  }
  .msg.win{color:var(--win); border-color:#216e54}
  .msg.lose{color:var(--lose); border-color:#5a2a2a}
  .pay{
    padding:10px 12px; border:1px solid #1f2835; border-radius:12px; background:#0f141b; color:var(--sub);
    font-size:13px; line-height:1.45
  }
  .pay code{color:var(--accent-2)}
  footer{color:#6f859f; font-size:12px; text-align:center; padding:10px 0 14px}
  @media (max-width:560px){
    .cell{font-size:46px}
    .controls{grid-template-columns:repeat(6,1fr)}
    .controls > div{grid-column:span 3}
    .controls button.primary{grid-column:span 6}
  }
</style>
</head>
<body>
  <div class="game" id="game">
    <header>
      <h1>æ‹‰éœ¸æ©Ÿ Â· Slot</h1>
      <div class="right">
        <div class="pill">é¤˜é¡ <b id="bal">1000</b></div>
        <div class="pill">ä¸Šå±€ <b id="last">0</b></div>
        <button id="snd" class="pill" title="åˆ‡æ›éŸ³æ•ˆ">ğŸ”Š</button>
      </div>
    </header>

    <section class="reels" id="reels">
      <!-- ä¸‰å€‹è½‰è¼ªã€æ¯è¼ªä¸‰æ ¼ -->
      <div class="col" id="c0">
        <div class="cell">ğŸ’</div>
        <div class="cell">ğŸ‹</div>
        <div class="cell">ğŸ””</div>
      </div>
      <div class="col" id="c1">
        <div class="cell">ğŸ‹</div>
        <div class="cell">ğŸ’</div>
        <div class="cell">ğŸ‡</div>
      </div>
      <div class="col" id="c2">
        <div class="cell">ğŸ‡</div>
        <div class="cell">7ï¸âƒ£</div>
        <div class="cell">ğŸ’</div>
      </div>
    </section>

    <section class="panel">
      <div class="controls">
        <div>
          <label>æŠ¼æ³¨ (æ¯ç·š)</label>
          <div class="value"><span id="bet">10</span></div>
          <input type="range" id="betRange" min="5" max="50" step="5" value="10" />
        </div>
        <div>
          <label>ç·šæ•¸ (1â€“5)</label>
          <div class="value"><span id="lines">5</span></div>
          <input type="range" id="lineRange" min="1" max="5" step="1" value="5" />
        </div>
        <div>
          <label>æ¨¡å¼</label>
          <select id="mode">
            <option value="norm">ä¸€èˆ¬</option>
            <option value="lucky">å¹¸é‹ï¼ˆç•¥é«˜RTPï¼‰</option>
          </select>
        </div>
        <div>
          <label>è‡ªå‹•æ—‹è½‰</label>
          <select id="auto">
            <option value="0">é—œé–‰</option>
            <option value="10">10 æ¬¡</option>
            <option value="25">25 æ¬¡</option>
            <option value="50">50 æ¬¡</option>
          </select>
        </div>

        <button id="spin" class="primary">SPIN æ—‹è½‰</button>
        <button id="max"  class="sec">MAX æ³¨</button>
        <button id="half" class="sec">HALF æ³¨</button>
      </div>

      <div class="msg" id="msg">æ­¡è¿ï¼Wild=ğŸƒ (å¯ä»£æ›¿ä»»æ„)ï¼ŒScatter=â­ (3+ è§¸ç™¼ 5 æ¬¡å…è²»æ—‹è½‰)ã€‚</div>

      <div class="pay">
        <b>è³ ä»˜è¡¨ï¼ˆ3å€‹åŒç¬¦è™Ÿï¼Œå€æ•¸ Ã— æŠ¼æ³¨ Ã— ç·šæ•¸ï¼‰ï¼š</b><br>
        7ï¸âƒ£ Ã—40ã€ğŸ’ Ã—20ã€ğŸ”” Ã—12ã€ğŸ‡ Ã—9ã€ğŸ‹ Ã—6ã€ğŸ’ Ã—4ã€ğŸƒ(Wild)=æœ€é«˜ç¬¦è™Ÿæ›¿ä»£ã€‚<br>
        <b>Scatter â­</b>ï¼šä»»æ„ä½ç½®å‡ºç¾ 3 å€‹ â†’ é€ <code>5</code> æ¬¡å…è²»æ—‹è½‰ï¼ˆå…è²»æ—‹è½‰æœŸé–“åŒè³ ä»˜ï¼‰ã€‚<br>
        æ¬Šé‡ï¼ˆå‡ºç¾æ©Ÿç‡ï¼‰å¯åœ¨ç¨‹å¼ç¢¼ä¸­èª¿æ•´ã€‚
      </div>
    </section>

    <footer>Â© Mini Slot â€“ for demo / personal use</footer>
  </div>

<script>
;(() => {
  // ======= ç¬¦è™Ÿã€æ¬Šé‡èˆ‡è³ ä»˜è¡¨ =======
  // ä½¿ç”¨ emoji å…åœ–æª”ï¼šå¯æ›¿æ›ç‚ºè‡ªå·±çš„ç´ æ
  const SYMBOLS = [
    { s:'7ï¸âƒ£', w:  3, pay:40 },   // ç¨€æœ‰
    { s:'ğŸ’', w:  5, pay:20 },
    { s:'ğŸ””', w:  7, pay:12 },
    { s:'ğŸ‡', w: 10, pay: 9 },
    { s:'ğŸ‹', w: 14, pay: 6 },
    { s:'ğŸ’', w: 16, pay: 4 },
    { s:'ğŸƒ', w:  4, pay: 0, wild:true },  // Wildï¼šç”¨ä¾†æ›¿ä»£
    { s:'â­', w:  6, pay: 0, scatter:true } // Scatterï¼š3å€‹è§¸ç™¼å…è²»æ—‹è½‰
  ];

  const payMap = Object.fromEntries(SYMBOLS.map(o=>[o.s,o.pay]));
  const isWild    = s => SYMBOLS.find(x=>x.s===s)?.wild;
  const isScatter = s => SYMBOLS.find(x=>x.s===s)?.scatter;

  // å»ºç«‹ç´¯ç©æ¬Šé‡è¡¨ï¼ˆåŠ å¿«æŠ½æ¨£ï¼‰
  function buildBag(mult=1){
    const bag=[];
    SYMBOLS.forEach(o=>{
      const times = Math.max(1, Math.round(o.w * mult));
      for(let i=0;i<times;i++) bag.push(o.s);
    });
    return bag;
  }
  let bagNorm = buildBag(1);
  let bagLucky= buildBag(1.2); // å¹¸é‹æ¨¡å¼ï¼šç•¥æ”¾å¤§æ¬Šé‡ï¼ˆæé«˜RTPï¼‰

  // ======= éŠæˆ²ç‹€æ…‹ =======
  let balance = 1000;
  let lastWin = 0;
  let freeSpins = 0;
  let autoLeft = 0;
  let soundOn = true;
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const reelsEl = $('#reels');
  const cols = [$('#c0'),$('#c1'),$('#c2')];

  // éŸ³æ•ˆï¼ˆç°¡å–®çš„ WebAudioï¼‰
  const SFX = (() => {
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    function beep(freq=440, dur=0.08, type='triangle', gain=0.05){
      if(!soundOn) return;
      const o=ctx.createOscillator(), g=ctx.createGain();
      o.type=type; o.frequency.value=freq; g.gain.value=gain;
      o.connect(g).connect(ctx.destination); o.start();
      o.stop(ctx.currentTime + dur);
    }
    return {
      spin(){ beep(320,0.08,'sawtooth',.05) },
      tick(){ beep(700,0.04,'square',.03) },
      win(){ beep(880,0.16,'triangle',.08); setTimeout(()=>beep(660,0.12,'triangle',.06),160) },
      lose(){ beep(220,0.12,'sine',.05) },
      scatter(){ beep(520,0.12,'square',.07) }
    }
  })();

  function updateHeader(){
    $('#bal').textContent = balance.toFixed(0);
    $('#last').textContent = lastWin.toFixed(0);
  }
  function setMessage(txt, cls=''){
    const m = $('#msg');
    m.className='msg'+(cls?(' '+cls):'');
    m.innerHTML = txt;
  }

  // ç”¢ç”Ÿ 3Ã—3 çµæœ
  function spinOnce(){
    const mode = $('#mode').value;
    const bag = (mode==='lucky'? bagLucky : bagNorm);
    const grid = [];
    for(let r=0;r<3;r++){
      grid[r]=[];
      for(let c=0;c<3;c++){
        const pick = bag[(Math.random()*bag.length)|0];
        grid[r][c]=pick;
      }
    }
    return grid; // [row][col]
  }

  // 5 æ¢ç·šï¼š3 æ©«ç·š + 2 æ–œç·š
  const lines = [
    [[0,0],[0,1],[0,2]],
    [[1,0],[1,1],[1,2]],
    [[2,0],[2,1],[2,2]],
    [[0,0],[1,1],[2,2]],
    [[2,0],[1,1],[0,2]],
  ];

  // è¨ˆç®—è³ ä»˜
  function evaluate(grid, activeLines, bet){
    // Scatter
    let scatters = 0;
    grid.flat().forEach(s=>{ if(isScatter(s)) scatters++; });
    let free=0;
    if(scatters>=3) free = 5;

    let win = 0;
    // æ¯æ¢ç·šï¼Œ3 é€£ç·šæ‰è³ ï¼ŒWild å¯ä»¥ä»£æ›¿
    for(let i=0;i<activeLines;i++){
      const pts = lines[i];
      const symbols = pts.map(([r,c])=>grid[r][c]);
      // å…ˆæŒ‘ä¸€å€‹ä½œç‚ºç›®æ¨™ç¬¦è™Ÿï¼ˆæ’é™¤scatterï¼‰ï¼Œè‹¥åŒ…å« Wild å‰‡ä»¥é Wild ç‚ºä¸»
      const nonWild = symbols.filter(s=>!isWild(s) && !isScatter(s));
      const target = nonWild[0] || '7ï¸âƒ£'; // å…¨ Wild æ™‚ï¼Œç•¶ä½œæœ€é«˜ç¬¦è™Ÿ
      if(symbols.every(s => isScatter(s) ? false : (s===target || isWild(s)))){
        const mult = payMap[target] || 40; // å…¨ Wild -> 7ï¸âƒ£
        win += mult * bet;
      }
    }
    return {win, free};
  }

  function drawGrid(grid){
    for(let c=0;c<3;c++){
      const col = cols[c];
      const cells = col.querySelectorAll('.cell');
      for(let r=0;r<3;r++){
        cells[r].textContent = grid[r][c];
      }
    }
  }

  function animateSpin(){
    reelsEl.classList.add('spinning');
    cols.forEach((col,i)=>{
      col.classList.add('spin');
      setTimeout(()=>col.classList.remove('spin'), 700+120*i);
    });
  }
  function endSpin(){
    reelsEl.classList.remove('spinning');
  }

  // ======= æŒ‰éˆ•èˆ‡æµç¨‹ =======
  updateHeader();
  $('#betRange').addEventListener('input', e=>$('#bet').textContent=e.target.value);
  $('#lineRange').addEventListener('input', e=>$('#lines').textContent=e.target.value);
  $('#max').addEventListener('click', ()=>{
    $('#betRange').value = 50; $('#bet').textContent = 50;
    $('#lineRange').value = 5;  $('#lines').textContent = 5;
  });
  $('#half').addEventListener('click', ()=>{
    const b = Math.max(5, Math.floor($('#betRange').value/2/5)*5);
    $('#betRange').value = b; $('#bet').textContent = b;
  });
  $('#snd').addEventListener('click', ()=>{
    soundOn = !soundOn;
    $('#snd').textContent = soundOn ? 'ğŸ”Š' : 'ğŸ”ˆ';
  });

  let spinning = false;

  async function doSpin(){
    if(spinning) return;
    spinning = true;

    const bet = +$('#bet').textContent;
    const lineNum = +$('#lines').textContent;
    const auto = +$('#auto').value;
    const totalBet = bet * lineNum;

    if(freeSpins<=0 && balance < totalBet){
      setMessage('é¤˜é¡ä¸è¶³ï¼Œè«‹èª¿å°æŠ¼æ³¨æˆ–ç·šæ•¸ã€‚', 'lose'); SFX.lose();
      spinning=false; return;
    }

    $('#spin').disabled = true;
    setMessage(freeSpins>0 ? `å…è²»æ—‹è½‰ä¸­ï¼ˆå‰©é¤˜ ${freeSpins}ï¼‰â€¦` : `æŠ•æ³¨ ${totalBet}ï¼Œç¥ä½ å¥½é‹ï¼`);
    if(freeSpins<=0) balance -= totalBet;
    updateHeader();

    animateSpin(); SFX.spin();

    // æ¨¡æ“¬è½‰å‹•æ™‚é–“
    await new Promise(r=>setTimeout(r,1200));

    const grid = spinOnce();
    drawGrid(grid);
    endSpin();

    const {win, free} = evaluate(grid, lineNum, bet);
    lastWin = win;
    balance += win;
    updateHeader();

    if(free>0){ freeSpins += free; setMessage(`â­ Scatter Ã—3ï¼ç²å¾— ${free} æ¬¡å…è²»æ—‹è½‰ã€‚`, 'win'); SFX.scatter(); }
    if(win>0){ setMessage(`æ­å–œä¸­ç +${win}`, 'win'); SFX.win(); }
    else     { setMessage('æœªä¸­çï¼Œä¸‹æ¬¡æœƒæ›´å¥½ã€‚', 'lose'); SFX.lose(); }

    // å…è²»æ—‹è½‰é‚è¼¯
    if(freeSpins>0){
      freeSpins--;
      await new Promise(r=>setTimeout(r,600));
      spinning=false;
      doSpin();
      return;
    }

    // è‡ªå‹•æ—‹è½‰
    if(autoLeft===0){ autoLeft = +$('#auto').value || 0; }
    if(autoLeft>0 && +$('#auto').value>0){
      autoLeft--;
      await new Promise(r=>setTimeout(r,650));
      spinning=false;
      doSpin();
      return;
    }

    $('#spin').disabled = false;
    spinning=false;
  }

  $('#spin').addEventListener('click', doSpin);

  // éµç›¤å¿«é€Ÿéµ
  window.addEventListener('keydown', e=>{
    if(e.code==='Space'){ e.preventDefault(); doSpin(); }
    if(e.key==='ArrowUp'){ const r=$('#betRange'); r.value=Math.min(50,+r.value+5); r.dispatchEvent(new Event('input')); }
    if(e.key==='ArrowDown'){ const r=$('#betRange'); r.value=Math.max(5,+r.value-5);  r.dispatchEvent(new Event('input')); }
    if(e.key==='ArrowRight'){ const r=$('#lineRange'); r.value=Math.min(5,+r.value+1); r.dispatchEvent(new Event('input')); }
    if(e.key==='ArrowLeft'){ const r=$('#lineRange'); r.value=Math.max(1,+r.value-1); r.dispatchEvent(new Event('input')); }
  });

  // åˆå§‹æç¤º
  setMessage('æŒ‰ä¸‹ã€ŒSPIN æ—‹è½‰ã€æˆ–ç©ºç™½éµé–‹å§‹ï¼');
})();
</script>
</body>
</html>
